import openpyxl
import subprocess
import pandas as pd

def get_yum_list():
    # subprocessでyumコマンド実行
    result = subprocess.run(['yum', 'list', 'installed'], stdout=subprocess.PIPE, text=True)
    lines = result.stdout.splitlines()

    # 表の開始位置を見つける（"Installed Packages" の行を基準にする）
    start_index = next((i for i, line in enumerate(lines) if "Installed Packages" in line), None)
    if start_index is None:
        raise ValueError("Installed Packages not found in yum output")

    # データ部分を抽出
    package_data = []
    for line in lines[start_index + 1:]:
        columns = line.split()
        if len(columns) >= 3:
            package_data.append({
                'Package': columns[0],
                'Version': columns[1],
                'Repository': columns[2]
            })

    # DataFrameに変換
    df = pd.DataFrame(package_data)
    return df

def save_to_excel(df, file_name):
    # Excelファイルに保存
    df.to_excel(file_name, index=False)

if __name__ == "__main__":
    df = get_yum_list()
    excel_file = "yum_list_installed.xlsx"
    save_to_excel(df, excel_file)
    print(f"Excel file saved: {excel_file}")