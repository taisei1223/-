#!/bin/bash

# ==========================
# è¨­å®šï¼ˆé©å®œå¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰
# ==========================
CERT_FILE="cert.pem"      # ã‚µãƒ¼ãƒãƒ¼è¨¼æ˜æ›¸
KEY_FILE="private.key"    # ç§˜å¯†éµ
CA_FILE="ca.pem"          # ãƒ«ãƒ¼ãƒˆè¨¼æ˜æ›¸
KEYSTORE_PASSWORD="keystorepassword"  # keystore.jks ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
TRUSTSTORE_PASSWORD="truststorepassword"  # truststore.jks ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
KEY_ALIAS="mycert"        # ã‚­ãƒ¼ã‚¹ãƒˆã‚¢ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹å

# ==========================
# PKCS12 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
# ==========================
echo "ğŸ”¹ PKCS12 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­..."
openssl pkcs12 -export \
    -in "$CERT_FILE" \
    -inkey "$KEY_FILE" \
    -certfile "$CA_FILE" \
    -out keystore.p12 \
    -name "$KEY_ALIAS" \
    -password pass:"$KEYSTORE_PASSWORD"

# ==========================
# keystore.jks ã«å¤‰æ›
# ==========================
echo "ğŸ”¹ keystore.jks ã‚’ä½œæˆä¸­..."
keytool -importkeystore \
    -srckeystore keystore.p12 \
    -srcstoretype PKCS12 \
    -destkeystore keystore.jks \
    -deststoretype JKS \
    -srcstorepass "$KEYSTORE_PASSWORD" \
    -deststorepass "$KEYSTORE_PASSWORD" \
    -alias "$KEY_ALIAS"

# ==========================
# truststore.jks ã‚’ä½œæˆ
# ==========================
echo "ğŸ”¹ truststore.jks ã‚’ä½œæˆä¸­..."
keytool -importcert \
    -alias rootCA \
    -file "$CA_FILE" \
    -keystore truststore.jks \
    -storepass "$TRUSTSTORE_PASSWORD" \
    -noprompt

# ==========================
# JKS ã®å†…å®¹ç¢ºèª
# ==========================
echo "ğŸ”¹ keystore.jks ã®å†…å®¹:"
keytool -list -keystore keystore.jks -storepass "$KEYSTORE_PASSWORD"

echo "ğŸ”¹ truststore.jks ã®å†…å®¹:"
keytool -list -keystore truststore.jks -storepass "$TRUSTSTORE_PASSWORD"

echo "âœ… PEM â†’ JKS å¤‰æ›ãŒå®Œäº†ã—ã¾ã—ãŸï¼"